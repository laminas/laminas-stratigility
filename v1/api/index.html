<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="laminas-stratigility"> 

    
    
        
    
    <meta name="docsearch:version" content="3.0.0,latest">
    <meta name="docsearch:language" content="en">
    <meta name="docsearch:component" content="laminas-stratigility">

    <link rel="canonical" href="https://docs.laminas.dev/laminas-stratigility/v1/api/">
    <link rel="shortcut icon" href="https://docs.laminas.dev/img/trademark-laminas-foundation-rgb.svg">

    <title>API Reference - laminas-stratigility - Laminas Docs</title>

    <link rel="stylesheet" href="https://docs.laminas.dev/css/styles.css">
    
</head>
<body id="page-top" class="components" data-spy="scroll" data-target=".toc" data-offset="20">

    
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        
        <a class="logo-link navbar-brand" href="https://getlaminas.org/" data-tooltip data-placement="bottom" title="Go to the Laminas homepage">
            <img src="https://docs.laminas.dev/img/laminas-foundation-white.svg" height="28" alt="Laminas">
        </a>
        <a class="navbar-title" href="https://docs.laminas.dev/" data-tooltip data-placement="bottom" title="Go to the Laminas Documentation">
            Documentation
        </a>

        
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <div class="dropdown sub-project-selector">
                        <a class="dropdown-toggle nav-link" data-toggle="dropdown" aria-expanded="false">
                            All Docs
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a href="https://docs.mezzio.dev/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-mezzio-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>Mezzio</strong><br>
                                        PSR-15 Middleware in Minutes
                                    </div>
                                </div>
                            </a>
                            <a href="https://docs.laminas.dev/components/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-components-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>Components</strong><br>
                                        Components for Enterprise Applications
                                    </div>
                                </div>
                            </a>
                            <a href="https://docs.laminas.dev/mvc" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-mvc-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>MVC</strong><br>
                                        MVC for Enterprise Applications
                                    </div>
                                </div>
                            </a>
                            <a href="https://api-tools.getlaminas.org/documentation" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-api-tools-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>API Tools</strong><br>
                                        Build RESTful APIs in Minutes
                                    </div>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item dropdown-item--secondardy" href="https://docs.laminas.dev/migration/">
                                <div class="row align-items-center">
                                    <div class="col-md-8 offset-md-4 col-sm-12">
                                        Migration to Laminas
                                    </div>
                                </div>
                            </a>
                            <a class="dropdown-item dropdown-item--secondardy" href="https://docs.laminas.dev/tutorials/">
                                <div class="row align-items-center">
                                    <div class="col-md-8 offset-md-4 col-sm-12">
                                        Tutorials
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="https://getlaminas.org/participate" class="nav-link">Community</a>
                </li>
            </ul>

            
            
                <div class="d-block d-sm-none">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">laminas-stratigility</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                
            

                
                

                    
                    
                
            

                
                
                    
                        
    <li class="subnavigation__list-item ">
        <a href="../install/" class="subnavigation__link">Installation and Requirements</a>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../usage/" class="subnavigation__link">Usage</a>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../middleware/" class="subnavigation__link">Middleware</a>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../error-handlers/" class="subnavigation__link">Error Handlers</a>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../creating-middleware/" class="subnavigation__link">Creating Middleware</a>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../executing-middleware/" class="subnavigation__link">Executing and composing middleware</a>
    </li>

                    
                        
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">API Reference</a>
    </li>

                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="d-block d-sm-none">
                <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</nav>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-8">
                <h1 class="header__title">
                    Components

                    
                        <small class="header__subtitle">laminas-stratigility</small>
                    
                </h1>
            </div>

            
            <div class="col-4 text-right">
                
                    
<div class="version-selector">
    <div class="btn-group">
        <button type="button" class="btn dropdown-toggle" data-toggle="dropdown" data-display="static" aria-haspopup="true" aria-expanded="false" id="version-selector-dropdown">
            
                v1
            
        </button>
        <div class="dropdown-menu dropdown-menu-right dropdown-menu-lg-left" aria-labelledby="version-selector-dropdown">
            
                
                    <a href="../../v3/intro/" class="dropdown-item">
                        
                            v3 (latest)
                        
                    </a>
                
            
                
                    <a href="../../v2/install/" class="dropdown-item">
                        
                            v2
                        
                    </a>
                
            
                
                    <a href="../install/" class="dropdown-item active">
                        
                            v1
                        
                    </a>
                
            
        </div>
    </div>
</div>


                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/laminas/laminas-stratigility" class="header__link header__link--github" title="Go to repository of laminas-stratigility">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-sm-12 content" role="main">
                
                
                    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">On this page</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#middleware" class="toc__link nav-link">Middleware</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#next" class="toc__link nav-link">Next</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#finalhandler" class="toc__link nav-link">FinalHandler</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#http-messages" class="toc__link nav-link">HTTP Messages</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#middleware_1" class="toc__link nav-link">Middleware</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#middleware-decorators" class="toc__link nav-link">Middleware Decorators</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#delegates" class="toc__link nav-link">Delegates</a>
                    </li>
                
            </ul>
        </div>
    

                

                
                    <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/">Overview</a></li>
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/components/">Components</a></li>

            
                <li class="breadcrumb-item"><a href="../..">laminas-stratigility</a></li>

                
                    
                        
                        
                    
                

                <li class="breadcrumb-item active" aria-current="page">API Reference</li>
            
        
    </ol>
</nav>



    <div class="alert alert-danger" role="alert">
        <h4>Caution</h4>
        <p>
            The documentation you are viewing is for an older version of this component.<br>
            <a href="../..">Switch to the latest (v3) version.</a>
        </p>
    </div>




    
    

    <h1 id="api-reference">API Reference</h1>
<p>The following make up the primary API of Stratigility.</p>
<h2 id="middleware">Middleware</h2>
<p><code>Laminas\Stratigility\MiddlewarePipe</code> is the primary application interface, and
has been discussed previously. Its API is:</p>
<pre class="highlight"><code class="language-php">namespace Laminas\Stratigility;

use Interop\Http\Middleware\DelegateInterface;
use Interop\Http\Middleware\MiddlewareInterface as InteropMiddlewareInterface;
use Interop\Http\Middleware\ServerMiddlewareInterface;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;

class MiddlewarePipe implements MiddlewareInterface, ServerMiddlewareInterface
{
    public function pipe(
        string|callable|InteropMiddlewareInterface|ServerRequestInterface $path,
        callable|InteropMiddlewareInterface|ServerRequestInterface $middleware = null
    );

    public function __invoke(
        ServerRequestInterface,
        ResponseInterface $response,
        callable $out = null
    ) :  ResponseInterface;

    public function process(
        ServerRequestInterface $request,
        DelegateInterface $delegate
    ) : ResponseInterface;
}</code></pre>
<p><code>pipe()</code> takes up to two arguments. If only one argument is provided,
<code>$middleware</code> will be assigned that value, and <code>$path</code> will be re-assigned to
the value <code>/</code>; this is an indication that the <code>$middleware</code> should be invoked
for any path. If <code>$path</code> is provided, the <code>$middleware</code> will only be executed
for that path and any subpaths.</p>
<blockquote>
<h3 id="request-path-changes-when-path-matched">Request path changes when path matched</h3>
<p>When you pipe middleware using a path (other than '' or '/'), the middleware
is dispatched with a request that strips the matched segment(s) from the start
of the path.</p>
<p>If, for example, you executed <code>$pipeline-&gt;pipe('/api', $api)</code>, and this was
matched via a URI with the path <code>/api/users/foo</code>, the <code>$api</code> middleware will
receive a request with the path <code>/users/foo</code>. This allows middleware
segregated by path to be re-used without changes to its own internal routing.</p>
</blockquote>
<p>Middleware is executed in the order in which it is piped to the
<code>MiddlewarePipe</code> instance.</p>
<p>The <code>MiddlewarePipe</code> is itself middleware, and can be executed in stacks that
expect the <code>__invoke()</code> signature (via the <code>__invoke()</code> signature), or stacks
expecting http-interop middleware signatures (via the <code>process()</code> method).</p>
<p>When executing the <code>MiddlewarePipe</code> via its <code>__invoke()</code> method, if <code>$out</code> is
not provided, an instance of <code>Laminas\Stratigility\FinalHandler</code> will be created
and used in the event that the pipe stack is exhausted (<code>MiddlewarePipe</code> passes
the <code>$response</code> instance it receives to <code>FinalHandler</code> as well, so that the
latter can determine if the response it receives is new).</p>
<blockquote>
<h3 id="out-is-no-longer-optional">$out is no longer optional</h3>
<p>Starting in version 1.3.0, we now raise a deprecation notice if no argument is
passed for the <code>$out</code> argument to <code>__invoke()</code>; starting in version 2.0.0,
the argument will be required.  Always pass a <code>Next</code> instance, a
<code>Laminas\Stratigility\NoopFinalHandler</code> instance, or a custom callback; we no
longer recommend the <code>FinalHandler</code> implementation.</p>
</blockquote>
<p>When using <code>__invoke()</code>, the callable <code>$out</code> argument should use the signature:</p>
<pre class="highlight"><code class="language-php">use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;

function (
    ServerRequestInterface $request,
    ResponseInterface $response
) : ResponseInterface</code></pre>
<p>Within Stratigility, <code>Laminas\Stratigility\Next</code> provides such an implementation.</p>
<p>Starting in version 1.3.0, <code>MiddlewarePipe</code> also implements the http-interop
<code>ServerMiddlewareInterface</code>, and thus provides a <code>process()</code> method. This
method requires a <code>ServerRequestInterface</code> instance and an
<code>Interop\Http\Middleware\DelegateInterface</code> instance on invocation; the latter
can be a <code>Next</code> instance, as it also implements that interface.</p>
<p>Internally, for both <code>__invoke()</code> and <code>process()</code>, <code>MiddlewarePipe</code> creates an
instance of <code>Laminas\Stratigility\Next</code>, feeding it its queue, executes it, and
returns its response.</p>
<h3 id="response-prototype">Response prototype</h3>
<p>Starting in version 1.3.0, you can compose a "response prototype" in the
<code>MiddlewarePipe</code>. When present, any callable middleware piped to the instance
will be wrapped in a decorator (see the <a href="#middleware-decorators">section on middleware
decorators</a>, below) such that it will now conform to
http-interop middleware interfaces.</p>
<p>To use this functionality, inject the prototype before piping middleware:</p>
<pre class="highlight"><code class="language-php">$pipeline = new MiddlewarePipe();
$pipeline-&gt;setResponsePrototype(new Response());</code></pre>
<h2 id="next">Next</h2>
<p><code>Laminas\Stratigility\Next</code> is primarily an implementation detail of middleware,
and exists to allow delegating to middleware registered later in the stack. It
is implemented both as a functor and as an <code>Interop\Http\Middleware\DelegateInterface</code>.</p>
<h3 id="functor-invocation">Functor invocation</h3>
<p>Because <code>Psr\Http\Message</code>'s interfaces are immutable, if you make changes to
your Request and/or Response instances, you will have new instances, and will
need to make these known to the next middleware in the chain. <code>Next</code> expects
these arguments for every invocation. Additionally, if an error condition has
occurred, you may pass an optional third argument, <code>$err</code>, representing the
error condition.</p>
<pre class="highlight"><code class="language-php">class Next
{
    public function __invoke(
        Psr\Http\Message\ServerRequestInterface $request,
        Psr\Http\Message\ResponseInterface $response
    ) : Psr\Http\Message\ResponseInterface;
}</code></pre>
<p>You should <strong>always</strong> either capture or return the return value of <code>$next()</code> when calling it in your
application. The expected return value is a response instance, but if it is not, you may want to
return the response provided to you.</p>
<blockquote>
<h3 id="err-argument">$err argument</h3>
<p>Technically, <code>Next::__invoke()</code> accepts a third, optional argument, <code>$err</code>.
However, as of version 1.3.0, this argument is deprecated, and usage will
raise a deprecation notice during runtime. We will be removing the argument
entirely starting with version 2.0.0.</p>
<h3 id="response-argument">$response argument</h3>
<p>Using the <code>$response</code> argument is unsafe when using delegation, as an inner
layer could return an entirely different response, ignoring any changes you
may have introduced previously. Additionally, when manipulating the response
from an inner layer, you may be inheriting unwanted context.</p>
<p>As such, we recommend ignoring the <code>$response</code> argument and doing one of the
following:</p>
<ul>
<li>For innermost middleware that will be returning a response without
  delegation, we recommend instantiating and returning a concrete
  response instance. <a href="https://docs.laminas.dev/laminas-diactoros/custom-responses/">Diactoros provides a number of convenient custom responses</a>.</li>
<li>For middleware delegating to another layer, operate on the <em>returned</em>
  response instead:</li>
</ul>
<pre class="highlight"><code class="language-php">$response = $next($request, $response);
return $response-&gt;withHeader('X-Foo', 'Bar');</code></pre>
</blockquote>
<h3 id="delegate-invocation">Delegate invocation</h3>
<ul>
<li>Since 1.3.0.</li>
</ul>
<p>When invoked as a <code>DelegateInterface</code>, the <code>process()</code> method will be invoked, and
passed a <code>ServerRequestInterface</code> instance <em>only</em>. If you need to return a response,
you will need to:</p>
<ul>
<li>Compose a response prototype in the middleware to use to build a response, or a
  canned response to return, OR</li>
<li>Create and return a concrete response type, OR</li>
<li>Operate on a response returned by invoking the delegate.</li>
</ul>
<h3 id="providing-an-altered-request">Providing an altered request</h3>
<pre class="highlight"><code class="language-php">// Standard invokable:
function ($request, $response, $next) use ($bodyParser)
{
    $bodyParams = $bodyParser($request);
    return $next(
        $request-&gt;withBodyParams($bodyParams), // Next will pass the new
        $response                              // request instance
    );
}

// http-interop invokable:
function ($request, DelegateInterface $delegate) use ($bodyParser)
{
    $bodyParams = $bodyParser($request);

    // Provide a new request instance to the delegate:
    return $delegate-&gt;process(
        $request-&gt;withBodyParams($bodyParams)
    );
}</code></pre>
<h3 id="returning-a-response-to-complete-the-request">Returning a response to complete the request</h3>
<p>If your middleware does not need to delegate to another layer, it's time to
return a response.</p>
<p>While we pass a response when using <code>Next</code> as a functor, we recommend creating
a new response, or providing your middleware with a response prototype; this
will ensure that the response is specific for your context.</p>
<pre class="highlight"><code class="language-php">use Interop\Http\Middleware\DelegateInterface;
use Laminas\Diactoros\Response;

$prototype = new Response();

// Standard invokable signature:
function ($request, $response, $next) use ($prototype)
{
    $response = $prototype-&gt;withAddedHeader('Cache-Control', [
        'public',
        'max-age=18600',
        's-maxage=18600',
    ]);
    return $response;
}

// http-interop invokable signature:
function ($request, DelegateInterface $delegate) use ($prototype)
{
    $response = $prototype-&gt;withAddedHeader('Cache-Control', [
        'public',
        'max-age=18600',
        's-maxage=18600',
    ]);
    return $response;
}</code></pre>
<h3 id="delegation">Delegation</h3>
<p>If your middleware is not capable of returning a response, or a particular path
in the middleware cannot return a response, return the result of executing the
delegate.</p>
<p>If using the legacy middleware signature, invoke the <code>$next</code> argument:</p>
<pre class="highlight"><code class="language-php">return $next($request, $response);</code></pre>
<p>If using a <code>DelegateInterface</code>, invoke its <code>process()</code> method:</p>
<pre class="highlight"><code class="language-php">return $delegate-&gt;process($request);</code></pre>
<p><strong>Middleware should always return a response, and, if it cannot, return the
result of delegation.</strong></p>
<h3 id="raising-an-error-condition">Raising an error condition</h3>
<ul>
<li>Deprecated as of 1.3.0; please use exceptions and a error handling middleware
  such as the <a href="../error-handlers/#handling-php-errors-and-exceptions">ErrorHandler</a>
  to handle error conditions in your application instead.</li>
</ul>
<p>To raise an error condition, pass a non-null value as the third argument to <code>$next()</code>:</p>
<pre class="highlight"><code class="language-php">function ($request, $response, $next)
{
    try {
        // try some operation...
    } catch (Exception $e) {
        return $next($request, $response, $e); // Next registered error middleware will be invoked
    }
}</code></pre>
<h2 id="finalhandler">FinalHandler</h2>
<ul>
<li>Deprecated starting with 1.3.0. Use <code>Laminas\Stratigility\NoopFinalHandler</code> or a
  custom handler guaranteed to return a response instead.</li>
</ul>
<p><code>Laminas\Stratigility\FinalHandler</code> is a default implementation of middleware to execute when the stack
exhausts itself. It expects three arguments when invoked: a request instance, a response instance,
and an error condition (or <code>null</code> for no error). It returns a response.</p>
<p><code>FinalHandler</code> allows two optional arguments during instantiation</p>
<ul>
<li><code>$options</code>, an array of options with which to configure itself. These options currently include:</li>
<li><code>env</code>, the application environment. If set to "production", no stack traces will be provided.</li>
<li><code>onerror</code>, a callable to execute if an error is passed when <code>FinalHandler</code> is invoked. The
    callable is invoked with the error (which will be <code>null</code> in the absence of an error), the request,
    and the response, in that order.</li>
<li><code>Psr\Http\Message\ResponseInterface $response</code>; if passed, it will compare the response passed
  during invocation against this instance; if they are different, it will return the response from
  the invocation, as this indicates that one or more middleware provided a new response instance.</li>
</ul>
<p>Internally, <code>FinalHandler</code> does the following on invocation:</p>
<ul>
<li>If <code>$error</code> is non-<code>null</code>, it creates an error response from the response provided at invocation,
  ensuring a 400 or 500 series response is returned.</li>
<li>If the response at invocation matches the response provided at instantiation, it returns it
  without further changes. This is an indication that some middleware at some point in the execution
  chain called <code>$next()</code> with a new response instance.</li>
<li>If the response at invocation does not match the response provided at instantiation, or if no
  response was provided at instantiation, it creates a 404 response, as the assumption is that no
  middleware was capable of handling the request.</li>
</ul>
<h2 id="http-messages">HTTP Messages</h2>
<h3 id="laminasstratigilityhttprequest">Laminas\Stratigility\Http\Request</h3>
<ul>
<li>Deprecated in 1.3.0; to be removed in 2.0.0.</li>
</ul>
<p><code>Laminas\Stratigility\Http\Request</code> acts as a decorator for a <code>Psr\Http\Message\ServerRequestInterface</code>
instance. The primary reason is to allow composing middleware such that you always have access to
the original request instance.</p>
<p>As an example, consider the following:</p>
<pre class="highlight"><code class="language-php">$app1 = new Middleware();
$app1-&gt;pipe('/foo', $fooCallback);

$app2 = new Middleware();
$app2-&gt;pipe('/root', $app1);

$server = Server::createServer($app2 /* ... */);</code></pre>
<p>In the above, if the URI of the original incoming request is <code>/root/foo</code>, what <code>$fooCallback</code> will
receive is a URI with a past consisting of only <code>/foo</code>. This practice ensures that middleware can be
nested safely and resolve regardless of the nesting level.</p>
<p>If you want access to the full URI â€” for instance, to construct a fully qualified URI to your
current middleware â€” <code>Laminas\Stratigility\Http\Request</code> contains a method, <code>getOriginalRequest()</code>,
which will always return the original request provided to the application:</p>
<pre class="highlight"><code class="language-php">function ($request, $response, $next)
{
    $location = $request-&gt;getOriginalRequest()-&gt;getUri()-&gt;getPath() . '/[:id]';
    $response = $response-&gt;setHeader('Location', $location);
    $response = $response-&gt;setStatus(302);
    return $response;
}</code></pre>
<h3 id="laminasstratigilityhttpresponse">Laminas\Stratigility\Http\Response</h3>
<ul>
<li>Deprecated in 1.3.0; to be removed in 2.0.0.</li>
</ul>
<p><code>Laminas\Stratigility\Http\Response</code> acts as a decorator for a <code>Psr\Http\Message\ResponseInterface</code>
instance, and also implements <code>Laminas\Stratigility\Http\ResponseInterface</code>, which provides the
following convenience methods:</p>
<ul>
<li><code>write()</code>, which proxies to the <code>write()</code> method of the composed response stream.</li>
<li><code>end()</code>, which marks the response as complete; it can take an optional argument, which, when
  provided, will be passed to the <code>write()</code> method. Once <code>end()</code> has been called, the response is
  immutable and will throw an exception if a state mutating method like <code>withHeader</code> is called.</li>
<li><code>isComplete()</code> indicates whether or not <code>end()</code> has been called.</li>
</ul>
<p>Additionally, it provides access to the original response created by the server via the method
<code>getOriginalResponse()</code>.</p>
<h2 id="middleware_1">Middleware</h2>
<p>Stratigility provides several concrete middleware implementations.</p>
<h3 id="errorhandler-and-notfoundhandler">ErrorHandler and NotFoundHandler</h3>
<p>These two middleware allow you to provide handle PHP errors and exceptions, and
404 conditions, respectively. You may read more about them in the
<a href="../error-handlers/">error handling chapter</a>.</p>
<h3 id="originalmessages">OriginalMessages</h3>
<p>This callable middleware can be used as the outermost layer of middleware in
order to set the original request, URI, and response instances as request
attributes for inner layers. See the <a href="../../v2/migration/#original-request-response-and-uri">v2 migration chapter</a>
for more details.</p>
<h2 id="middleware-decorators">Middleware Decorators</h2>
<p>Starting in version 1.3.0, we offer the ability to work with http-interop
middleware. Internally, if a response prototype is composed in the
<code>MiddlewarePipe</code>, callable middleware piped to the <code>MiddlewarePipe</code> will be
wrapped in one of these decorators.</p>
<p>Two versions exist:</p>
<ul>
<li><code>Laminas\Stratigility\Middleware\CallableMiddlewareWrapper</code> will wrap a callable
  using the legacy interface; as such, it also requires a response instance:</li>
</ul>
<pre class="highlight"><code class="language-php">$middleware = new CallableMiddlewareWrapper($middleware, $response);</code></pre>
<ul>
<li><code>Laminas\Stratigility\Middleware\CallableMiddlewareWrapper</code> will wrap a callable
  that defines exactly two arguments, with the second type-hinting on
  <code>Interop\Http\Middleware\DelegateInterface</code>:</li>
</ul>
<pre class="highlight"><code class="language-php">$middleware = new CallableMiddlewareWrapper(
  function ($request, DelegateInterface $delegate) {
      // ...
  }
);</code></pre>
<p>You can manually decorate callable middleware using these decorators, or simply
let <code>MiddlewarePipe</code> do the work for you. To let <code>MiddlewarePipe</code> handle this,
however, you <em>must</em> compose a response prototype prior to piping middleware
using the legacy middleware signature.</p>
<h2 id="delegates">Delegates</h2>
<p>In addition to <code>Laminas\Stratigility\Next</code>, Stratigility provides another
<code>Interop\Http\Middleware\DelegateInterface</code> implementation,
<code>Laminas\Stratigility\Delegate\CallableDelegateDecorator</code>.</p>
<p>This class can be used to wrap a callable <code>$next</code> instance for use in passing
to a <code>ServerMiddlewareInterface::process()</code> method as a delegate; the primary
use case is adapting functor middleware to work as http-interop middleware.</p>
<p>As an example:</p>
<pre class="highlight"><code class="language-php">use Interop\Http\Middleware\DelegateInterface;
use Interop\Http\Middleware\ServerMiddlewareInterface;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use Laminas\Stratigility\Delegate\CallableDelegateDecorator;

class TimestampMiddleware implements ServerMiddlewareInterface
{
    public function __invoke(
        ServerRequestInterface $request,
        ResponseInterface $response,
        callable $next
    ) {
        return $this-&gt;process($request, new CallableDelegateDecorator($next, $response));
    }

    public function process(
        ServerRequestInterface $request,
        DelegateInterface $delegate
    ) {
        $response = $delegate-&gt;process($request);
        return $response-&gt;withHeader('X-Processed-Timestamp', time());
    }
}</code></pre>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../executing-middleware/">
                    <small class="page-nav__label">Previous</small>
                    <i class="fa fa-chevron-left"></i>
                    Executing and composing middleware
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
        </li>
    </ul>
</nav>



                
            </div>
            <div class="col-md-3 col-sm-12 sidebar">
                <div class="donation-banner">
    <a href="https://getlaminas.org/support/">
        <h2>Donate</h2>
        <p>Support Laminas Developers Directly</p>
        <img src="https://funding.communitybridge.org/assets/cb-f-horizontal-white.svg">
    </a>
</div>

                
                    <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">laminas-stratigility</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                
            

                
                

                    
                    
                
            

                
                
                    
                        
    <li class="subnavigation__list-item ">
        <a href="../install/" class="subnavigation__link">Installation and Requirements</a>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../usage/" class="subnavigation__link">Usage</a>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../middleware/" class="subnavigation__link">Middleware</a>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../error-handlers/" class="subnavigation__link">Error Handlers</a>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../creating-middleware/" class="subnavigation__link">Creating Middleware</a>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../executing-middleware/" class="subnavigation__link">Executing and composing middleware</a>
    </li>

                    
                        
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">API Reference</a>
    </li>

                    
                
            
        </ul>
    </div>

                    
                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h5>Laminas</h5>
                <ul>
                    <li>Laminas Project <a href="https://getlaminas.org/">The new foundation for the community-supported, open source continuation of Zend Framework</a></li>
                    <li>Laminas Components and MVC <a href="https://docs.laminas.dev/">Components and MVC for enterprise applications</a></li>
                    <li>Mezzio <a href="https://docs.mezzio.dev/">PSR-15 middleware in minutes</a></li>
                    <li>Laminas API Tools <a href="https://api-tools.getlaminas.org/">Build RESTful APIs in minutes</a></li>
                </ul>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="row">

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Support</h4>
                        <ul class="support__list">
                            <li class="support__list-item">
                                <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://laminas.dev/chat" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://github.com/laminas" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://twitter.com/getlaminas" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/blog/rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                            </li>
                        </ul>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">License</h4>
                        <p>
                            Code licensed under <a
                                href="https://github.com/laminas/laminas-stratigility/blob/-/LICENSE.md">BSD 3-Clause</a>.
                        </p>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Copyright</h4>
                        <p>
                            <!--Built with love by the Laminas team with the help of our
                            <a href="https://github.com/laminas/laminas-stratigility/graphs/contributors">contributors</a>.<br>-->
                            &copy; 2023 <a href="https://getlaminas.org/">Laminas Project</a> a Series of LF Projects, LLC.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

    <script>
        let base_url = '../..',
            project  = "components",
            siteName = 'laminas-stratigility';
    </script>
    <script src="https://docs.laminas.dev/js/scripts.js"></script>
    
        <script src="../../search/main.js"></script>
    

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search in laminas-stratigility" id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
        </div>
    </div>
</div>
</body>


</html>
